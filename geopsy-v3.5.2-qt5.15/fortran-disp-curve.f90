! for testing it 
! ensure that you set the env.
! export LD_LIBRARY_PATH=/home/user/geopsy/lib/:$LD_LIBRARY_PATH
! Then run it
! gfortran fortran-disp-curve.f90 -L/home/user/geopsy/lib/ -lQGpCoreTools -lQGpCoreWave -o testfo
! ./testfo

program main
    implicit none

    ! Declarations
    integer, parameter :: nLayers = 3
    integer, parameter :: nSamples = 187
    integer, parameter :: nModes = 0
    integer :: verbose
    real(8) :: h(nLayers), vp(nLayers), vs(nLayers), rho(nLayers)
    real(8) :: omega(nSamples), slowness(nSamples*nModes)
    integer :: i
    character(len=100) :: filename

    ! Constants
    real(8), parameter :: pi = 3.1415926535897932384626433832795d0

    ! Initialize model parameters
    h = [7.5d0, 25.0d0, 0.0d0] ! Assuming the third layer has no thickness
    vp = [1500.0d0, 2000.0d0, 3000.0d0] ! Example velocities
    vs = [1000.0d0, 1500.0d0, 2500.0d0] ! Example velocities
    rho = [1800.0d0, 1900.0d0, 2500.0d0] ! Example densities

    omega = [0.200885573645323d0, &
        0.205907712986456d0, &
        0.211055405811117d0, &
        0.216331790956395d0, &
        0.221740085730305d0, &
        0.227283587873563d0, &
        0.232965677570402d0, &
        0.238789819509662d0, &
        0.244759564997403d0, &
        0.250878554122338d0, &
        0.257150517975397d0, &
        0.263579280924782d0, &
        0.270168762947901d0, &
        0.276922982021599d0, &
        0.283846056572139d0, &
        0.290942207986442d0, &
        0.298215763186103d0, &
        0.305671157265756d0, &
        0.3133129361974d0, &
        0.321145759602334d0, &
        0.329174403592393d0, &
        0.337403763682203d0, &
        0.345838857774258d0, &
        0.354484829218614d0, &
        0.363346949949079d0, &
        0.372430623697806d0, &
        0.381741389290251d0, &
        0.391284924022508d0, &
        0.40106704712307d0, &
        0.411093723301147d0, &
        0.421371066383676d0, &
        0.431905343043268d0, &
        0.442702976619349d0, &
        0.453770551034833d0, &
        0.465114814810704d0, &
        0.476742685180971d0, &
        0.488661252310496d0, &
        0.500877783618258d0, &
        0.513399728208714d0, &
        0.526234721413932d0, &
        0.53939058944928d0, &
        0.552875354185512d0, &
        0.56669723804015d0, &
        0.580864668991154d0, &
        0.595386285715933d0, &
        0.610270942858831d0, &
        0.625527716430302d0, &
        0.641165909341059d0, &
        0.657195057074585d0, &
        0.67362493350145d0, &
        0.690465556838986d0, &
        0.707727195759961d0, &
        0.72542037565396d0, &
        0.743555885045309d0, &
        0.762144782171441d0, &
        0.781198401725727d0, &
        0.80072836176887d0, &
        0.820746570813092d0, &
        0.841265235083419d0, &
        0.862296865960505d0, &
        0.883854287609517d0, &
        0.905950644799755d0, &
        0.928599410919749d0, &
        0.951814396192743d0, &
        0.975609756097561d0, &
        1.0d0, & 
        1.025d0, & 
        1.050625d0, &
        1.076890625d0, &
        1.103812890625d0, & 
        1.13140821289062d0, &
        1.15969341821289d0, &
        1.18868575366821d0, &
        1.21840289750992d0, &
        1.24886296994767d0, &
        1.28008454419636d0, &
        1.31208665780127d0, &
        1.3448888242463d0, &
        1.37851104485245d0, &
        1.41297382097377d0, &
        1.44829816649811d0, &
        1.48450562066056d0, &
        1.52161826117708d0, &
        1.5596587177065d0, &
        1.59865018564917d0, &
        1.63861644029039d0, &
        1.67958185129765d0, &
        1.7215713975801d0, &
        1.7646106825196d0, &
        1.80872594958259d0, &
        1.85394409832215d0, &
        1.90029270078021d0, &
        1.94780001829971d0, &
        1.9964950187572d0, &
        2.04640739422613d0, &
        2.09756757908179d0, &
        2.15000676855883d0, &
        2.2037569377728d0, &
        2.25885086121712d0, &
        2.31532213274755d0, &
        2.37320518606624d0, &
        2.43253531571789d0, &
        2.49334869861084d0, &
        2.55568241607611d0, &
        2.61957447647801d0, &
        2.68506383838996d0, &
        2.75219043434971d0, &
        2.82099519520845d0, &
        2.89152007508867d0, &
        2.96380807696588d0, &
        3.03790327889003d0, &
        3.11385086086228d0, &
        3.19169713238384d0, &
        3.27148956069343d0, &
        3.35327679971077d0, &
        3.43710871970354d0, &
        3.52303643769612d0, &
        3.61111234863853d0, &
        3.70139015735449d0, &
        3.79392491128835d0, &
        3.88877303407056d0, &
        3.98599235992232d0, &
        4.08564216892038d0, &
        4.18778322314339d0, &
        4.29247780372198d0, &
        4.39978974881502d0, &
        4.5097844925354d0, &
        4.62252910484878d0, &
        4.73809233247d0, &
        4.85654464078175d0, &
        4.9779582568013d0, &
        5.10240721322133d0, &
        5.22996739355186d0, &
        5.36071657839066d0, &
        5.49473449285042d0, &
        5.63210285517168d0, &
        5.77290542655097d0, &
        5.91722806221475d0, &
        6.06515876377012d0, &
        6.21678773286437d0, &
        6.37220742618598d0, &
        6.53151261184063d0, &
        6.69480042713664d0, &
        6.86217043781506d0, &
        7.03372469876043d0, &
        7.20956781622944d0, &
        7.38980701163518d0, &
        7.57455218692606d0, &
        7.76391599159921d0, &
        7.95801389138919d0, &
        8.15696423867392d0, &
        8.36088834464076d0, &
        8.56991055325678d0, &
        8.7841583170882d0, &
        9.00376227501541d0, &
        9.22885633189079d0, &
        9.45957774018806d0, &
        9.69606718369276d0, &
        9.93846886328508d0, &
        10.1869305848672d0, &
        10.4416038494889d0, &
        10.7026439457261d0, &
        10.9702100443693d0, &
        11.2444652954785d0, &
        11.5255769278654d0, &
        11.8137163510621d0, &
        12.1090592598386d0, &
        12.4117857413346d0, &
        12.722080384868d0, &
        13.0401323944897d0, &
        13.3661357043519d0, &
        13.7002890969607d0, &
        14.0427963243847d0, &
        14.3938662324943d0, &
        14.7537128883067d0, &
        15.1225557105144d0, &
        15.5006196032772d0, &
        15.8881350933591d0, &
        16.2853384706931d0, &
        16.6924719324604d0, &
        17.109783730772d0, &
        17.5375283240413d0, &
        17.9759665321423d0, &
        18.4253656954458d0, &
        18.885999837832d0, &
        19.3581498337778d0, &
        19.8421035796222d0 ]

    ! Convert frequencies to angular frequencies if necessary
    do i = 1, nSamples
        omega(i) = omega(i) * (2.0d0 * pi) ! convert to angular frequency
    end do

    ! Dispersion computation, fundamental mode only (Rayleigh waves)
    verbose = 1 ! Verbose output
    call dispersion_curve_init(verbose)
    call dispersion_curve_rayleigh(nLayers, h, vp, vs, rho, nSamples, omega, nModes, slowness, 1) ! 0 for phase


    ! Write output to a text file
    filename = "fort-output.txt"
    open(unit=10, file=filename, status="replace")
    do i = 1, nSamples
        write(10, '(A,F12.6,A,F12.6,A,F12.6)') "Frequency: ", omega(i), ", Slowness: ", slowness(i), ", Vg: ", 1.0d0/slowness(i)
    end do
    close(10)
end program main

